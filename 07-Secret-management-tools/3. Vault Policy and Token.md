- **HashiCorp Vault** uses **policies** to define _what_ you can access, and **tokens** to represent _who_ you are.
### Step 1. Control Access (Most Important)
Create policy:
```bash
nano read-api.hcl
```

```bash
path "secret/data/api" {
   capabilities = ["read"] 
}
```

Apply or Load Policy:
```bash
# load the policy
vault policy write read-api api-read.hcl
```

Create a token with that policy:
```bash
vault token create -policy=read-api

# Create a Token with attack that policy and set env.
export VAULT_TOKEN="$(vault token create -field=token -policy=my-policy)"
```

Test:
```bash
export VAULT_TOKEN=s.limitedtoken vault kv get secret/api
```

### Policy Commands Cheat Sheet
```bash
# Write policy from HCL file (define permissions)
vault policy write read-api api-read.hcl

# List all policies
vault policy list

# Read policy content (audit/debug)
vault policy read read-api

# Delete the policy
vault policy delete policy_name

# Check the capabilities of the given path
vault token capabilities secrets/webui
```

## Token 
- Is a secure, opaque string used to authenticate users, systems, or applications to the Vault API, CLI and GUI.

### There are 5 main types of token.
### 1. Root Token
```php
Type                 : root
Power                : FULL (everything) and root policy attach
TTL                  : No
Renewable & modified : No   
Stored               : Yes
# Regenerate the root token using
vault operator generate-root
```
**Use:** Initial setup, disaster recovery  
**Danger:** Total compromise if leaked

### 2. Service Token (default)
```php
Type        : service       # Service token start with... hvs.
Power       : Policy-based
TTL         : Yes
Renewable   : Yes
Stored      : Yes
```
**Use:** Users, apps, CI/CD  
**Most common token**

### 3. Batch Token
```php
Type        : batch             # Batch Token start with ... hvb.
Power       : Policy-based
TTL         : Yes
Renewable   : No
Stored      : No
```
**Use:** High-scale / short jobs  
**Notes:** Fast, low audit visibility

### 4. Periodic Token
```php
Type        : system & service to perfrom the action frequently
Power       : Policy-based
TTL         : No expiry  
Renewable   : Yes (must)
Stored      : Yes
```
**Use:** Long-running services  
Root or sudo users can generate the periodic token.

### 5. Orphan Token
```php
Type        : orphan
Power       : Policy-based
TTL         : Depends
Renewable   : Depends
Stored      : Yes
```
**Use:** CI/CD, automation  
**Independent of parent token**
### 6. Recovery Token
```php
Type        : recovery
Purpose     : Disaster recovery only
Power       : Limited admin (not full root)
Stored      : No (generated during init)
Renewable   : No
TTL         : No
```
**Not a normal login token**  
**Used only when Vault is sealed or broken**

### Token Commands Cheat Sheet
```bash
# Create token with policy + TTL (user/app access)
vault token create -policy=read-api -ttl=1h

# Create service token (no parent, no default policy)
vault token create -policy=read-api -orphan -no-default-policy

# Revoke token immediately (incident response)
vault token revoke s.xxxxx
--------------------------------------------------------------------------------
# Create a token with 1H and its only Use for 2 Times.
vault token create -ttl=1h -use-limit=2 -policy=<policy_name>

# Check the token details 
vault token lookup <TOKEN>

# Create period token which is valid to for 24H only
vault token create -policy=default -period=24h

# Create a short-live token only for 1H
vault token create -ttl=1h

# Create a Orphan Token
vault token create -orphan

# Create a Role Token.
vault write auth/token/roles/admin_user allowed_policies="policy1, policy2" orphan=true period=1h

vault token create -role=admin_user

# Create a token with token is renewal after sometime.
vault token create -ttl=30 -explicit-max-ttl=120 -policy=default
# after this token is expire in 30s.. then after renewal...
vault token renew <EXPIRE_TOKEN>
# You want to increase the expire time use this
vault token renew -increment=60 <EXPIRE_TOKEN>

# Create a CHILD TOKEN
VAULT_TOKEN=<TOKEN> vault token create -ttl=180 -policy=default

```

### Quick Mapping (Mental Model)
```bash
# Policy = permissions
vault policy write <policy>

# Token = identity + policy
vault token create -policy=<policy>
```
