-  authentication mechanism designed specifically for machine-to-machine (M2M) and application-to-machine (A2M) scenarios.
- It allows automated services, CI/CD pipelines, and applications to securely authenticate with Vault using a two-part credential—a `RoleID` (username) and a `SecretID` (password)—to retrieve temporary, policy-based tokens.

### Mental Model
```bash
Policy  → permissions
Role    → app identity
RoleID  → username
SecretID→ password
Token   → session
```

### Step1. AppRole Setup
```bash
# enable AppRole auth
vault auth enable approle  

# To list the all auth Methods.
vault auth list      
```

### Step2. Role & Policy
```bash
# create policy
vault policy write api-read api-read.hcl

 # create role
vault write auth/approle/role/api-role \
  secret_id_ttl=10m \
  token_num_uses=10 \
  secret_id_num_uses=40 \
  token_policies="policy-name" \
  token_ttl=1h token_max_ttl=4h
```

### Step3. Get the RoleID / SecretID
```bash
# get RoleID (public)
vault read auth/approle/role/api-role/role-id

# Generate SecretID
vault write -f auth/approle/role/app-role/secret-id
```

### Step4. Login (Get Token)
```bash
vault write auth/approle/login \
  role_id=ROLE_ID \
  secret_id=SECRET_ID
```

### Step5. Use Token
```bash
export VAULT_TOKEN=s.xxxxx
vault login token=hvs.xxxxxxxxxxxxxxxxx
vault kv get secret/api
```

### Step6. Secure AppRole (Best Practice)
```bash
vault write auth/approle/role/api-role \
  secret_id_ttl=60m \
  secret_id_num_uses=1 \
  token_num_uses=100 \
  bind_secret_id=true
```

### Step7. Rotate / Revoke
```bash
# Revoke SecretIDs
vault write auth/approle/role/api-role/secret-id/destroy-all

# revoke token
vault token revoke s.xxxxx

## delete role
vault delete auth/approle/role/api-role
```

---
---

### Token Authentication
- The primary, identity-based authentication method used by clients (users, applications, machines) to interact with Vault's API, CLI, or UI.
- Act as temporary, policy-bound credentials that grant, restrict, or revoke access to secrets, with types including root, services and batch token, which is essential for secure, authorized operations.


```bash
# login with login 
vault login

vault login -method=oidc
vault login -method=ldap username=alice
vault login -method=github

# Revoke token 
vault token revoke <TOKEN>

# Revoke all token under a parents.
vault token revoke -mode=path auth/approle

# View all token info 
vault token lookup
```

Disable access:--
```bash
# Disable AppRole auth method
vault auth disable approle

# Delete policy
vault policy delete app-policy
```

---

### **GitHub authentication with Vault token**
1. Enable GitHub auth (admin / root token)
 ```bash
 vault auth enable github
 ```

2. Configure GitHub org
```bash
# 1. Create a githubn Org and team..
# 2. Create a personal access token...
# 3. Then after run this command..
vault write auth/github/config organization=my-github-org
```

3. Create a policy
```bash
vault policy write dev-policy - <<EOF
path "secret/data/dev/*" {
  capabilities = ["read"]
}
EOF
```

4. Map GitHub user or team to policy
```bash
# Map user
vault write auth/github/map/users/alice value=dev-policy

# OR map team
vault write auth/github/map/teams/dev-team value=dev-policy
```

5. Login using GitHub token
First, create a **GitHub Personal Access Token (PAT)**  
(scopes: `read:org`)
```bash
vault login -method=github 
# paste the token value...
```

6. Vault issues a token
```bash
# TOEKN EXAMPLE:_------
token: hvs.CAES...

# Use the vault token perform actions
vault kv get secret/dev/app-config
```

7.  Revoke and delete 
```bash
vault token revoke -path auth/github

# Also disable the github auth method
vault auth disable github

# Verify
vault auth list
```

